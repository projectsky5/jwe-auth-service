ДЗ №5 Т1 Иннотех

**Внимание! Overengineering!**

---

Задание: Токен содержит чувствительную информацию и передается по незащищенному каналу.
Необходимо обеспечить защиту информации как от компрометации, так и от подмены в том
числе участниками обмена

---

**Реализация:**

  1. Токен сначала подписывается на уровне JWS с помощью HS512 - обеспечивает неизменяемость содержимого
  2. Подписанный JWT шифруется в JWE. Для упаковки ключа используется RSA-OAEP-256, для cipher - A256GCM
    
---

Детали реализации:
  1. Полноценный микросервис авторизации с JWE шифрованием токена
  2. Использован Redis в качестве in-memory хранения токенов в вайтлисте
  3. Применен паттерн Observer для добавления\удаления токена из вайтлиста
  4. Глобальная обработка ошибок
  5. Валидация входных данных
  6. Эндпоинты для тестирования функционала ролевой модели

---

**Инструкция по тестированию**

1. Сгенерируйте ключи шифрования с помощью OpenSSL CLI

JWE:
```
openssl genrsa -out enc_private.pem 4096
openssl rsa -in enc_private.pem -pubout -out enc_public.pem
```

JWS: (HMAC):
```
openssl rand -base64 64
```

2. Содержимое ключей поместите в .env файл

<img width="233" height="302" alt="image" src="https://github.com/user-attachments/assets/386e7dc6-79b9-4fb9-8fdc-67f9e1b52db8" />

3. Определите имя, пользователя, пароль для БД

4. Запустите сервис и зарегистрируйтесь (username + password)

5. Для тестирования ролевой модели используйте:

- GET /api/v1/hello/user - доступен только для роли user

- GET /api/v1/hello/admin - доступен только для роли admin

- PATCH /api/v1/auth/role/toggle - меняет роль пользователя, выдает новый токен (PATCH в данном случае не идемпотентен)

- POST /api/v1/token/revoke - отзывает текущий токен

---

Отчет swagger:

<img width="1099" height="391" alt="image" src="https://github.com/user-attachments/assets/1fbcb861-7105-45c1-8030-a5ecbdba3564" />



